service: ycapi

custom:
  settings:
    POSTS_TABLE: ycvideos

provider:
  name: aws
  runtime: nodejs12.x
  region: ap-southeast-2
  environment: ${self:custom.settings}
  iamRoleStatements:
    - Effect: "Allow"
      Action:
        - dynamodb:*
        - s3:*
        - ses:*
        - logs:CreateLogGroup,
        - logs:CreateLogStream,
        - logs:PutLogEvents,
        - logs:DescribeLogStreams
      Resource:
        "*"
        # - "arn:aws:dynamodb:${self:provider.region}:*:table/${self:custom.settings.POSTS_TABLE}"

functions:
  createVideo:
    handler: handler.createVideo
    events:
      - http:
          path: /createVideo
          method: post
          cors: true
  getAllVideos:
    handler: handler.getAllVideos
    events:
      - http:
          path: /posts
          method: get
          cors: true
  # getPosts:
  #   handler: handler.getPosts
  #   events:
  #     - http:
  #         path: /posts/{number}
  #         method: get
  getPost:
    handler: handler.getPost
    events:
      - http:
          path: /getOneComment/{videoID}/timeStamp/{creatSort}
          method: get
          cors: true
  getAllVideoID:
    handler: handler.getAllVideoID
    events:
      - http:
          path: /video/{videoID}
          method: get
          cors: true
  likeComment:
    handler: handler.likeComment
    events:
      - http:
          path: /like/{videoID}/timeStamp/{creatSort}
          method: put
          cors: true
  unLikeComment:
    handler: handler.unLikeComment
    events:
      - http:
          path: /unLike/{videoID}/timeStamp/{creatSort}
          method: put
          cors: true
  unLikeCommentWithout:
    handler: handler.unLikeCommentWithout
    events:
      - http:
          path: /unLikeWithout/{videoID}/timeStamp/{creatSort}
          method: put
          cors: true
  disLikeComment:
    handler: handler.disLikeComment
    events:
      - http:
          path: /disLike/{videoID}/timeStamp/{creatSort}
          method: put
          cors: true
  unDisLikeComment:
    handler: handler.unDisLikeComment
    events:
      - http:
          path: /unDisLike/{videoID}/timeStamp/{creatSort}
          method: put
          cors: true
  unDisLikeCommentWithout:
    handler: handler.unDisLikeCommentWithout
    events:
      - http:
          path: /unDisLikeWithout/{videoID}/timeStamp/{creatSort}
          method: put
          cors: true
  deleteMainComment:
    handler: handler.deleteMainComment
    events:
      - http:
          path: /deleteComment/{videoID}/timeStamp/{creatSort}
          method: delete
          cors: true
  replyToMainComment:
    handler: handler.replyToMainComment
    events:
      - http:
          path: /replyToMainComment/{videoID}/timeStamp/{creatSort}
          method: put
          cors: true

resources:
  Resources:
    PostsTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: ${self:custom.settings.POSTS_TABLE}
        AttributeDefinitions:
          - AttributeName: "videoID"
            AttributeType: "S"
          - AttributeName: "creatSort"
            AttributeType: "N"
          - AttributeName: "trend"
            AttributeType: "N"
        KeySchema:
          - AttributeName: "videoID"
            KeyType: "HASH"
          - AttributeName: "creatSort"
            KeyType: "RANGE"
        #BillingMode: PAY_PER_REQUEST
        ProvisionedThroughput:
          ReadCapacityUnits: 1
          WriteCapacityUnits: 1
        LocalSecondaryIndexes:
          - IndexName: "myLSI"
            KeySchema:
              - AttributeName: "videoID"
                KeyType: "HASH"
              - AttributeName: "trend"
                KeyType: "RANGE"
            Projection:
              # NonKeyAttributes:
              #   - "creatSort"
              ProjectionType: "ALL"
